## 概述

本模块旨在为 KingdomRush 游戏提供一套非侵入式的二次改版开发解决方案。通过模块化架构，可在不修改原始源代码的前提下，实现对游戏功能的扩展、修改和定制。

## 功能
#### 1. 提供钩子函数
- 用于在指定函数增加前逻辑与后逻辑
- 链式调用支持同一个函数增加多个钩子

#### 2. 模组内目录拥有高加载优先级
- 可直接覆盖原模块

#### 3. 提供简易多模组管理
- 自动加载 mods 目录下的所有模组
- 模组按优先级降序加载，高优先级模组将会覆盖低优先级模块的修改

## 使用方法

### 1. 基础模块结构
创建模块目录并实现必要文件：

```
mods/
└── your_mod/
    ├── config.lua          -- 模块配置
    ├── your_mod.lua        -- 模块主逻辑，名称务必与当前目录相同
    └── subfolder/          -- [可选] 可选子目录
        └── modules.lua     -- 模块
```

### 2. 安装模块
#### 方法 1.
1. 将游戏根目录的 `main` 拖入到安装模块脚本文件夹
2. 运行脚本
3. 将 `main` 拖回游戏根目录即可

注：
1. 对于已打包的游戏，需要打开 exe 压缩包操作
2. 脚本会修改 main 文件，源文件备份在 output 文件夹内

#### 方法 2.
将 `main` 的 `love.update`（前三代为 `load_director`） 函数的 `director:init(main.params)` 字段修改为：
```lua
require("mods.mod_main"):init(director)
```

### 3. 配置示例
```lua
-- config.lua
return {
    name = "UI增强模块",            -- 名称
    desc = "提供额外的用户界面功能",  -- 描述
    version = "1.0.0",            -- 版本
    game_version = "kr5",         -- 兼容游戏版本，可为表
    by = "开发者",                 -- 作者
    url = "https://example.com",  -- 发布页面
    enabled = true,               -- 启用状态
    priority = 150                -- 优先级
}
```

### 4. 模块实现
```lua
-- your_mod.lua
local M = {}

function M:init()
    -- 模块初始化逻辑
    -- 在此处实现HOOK、事件监听等功能
    HOOK(E, "load", self.E_load)
end

function M.E_load(origin, self, ...)
	--	在此处增加前逻辑...
	origin(...)	-- 执行原函数
	--	在此处增加后逻辑...
end

return M
```

## 开发规范

### 1. 错误处理
- 提供详细的日志输出便于调试
- 对关键操作进行异常捕获

### 2. 兼容性考虑
- 由于模块加载顺序，所有修改应在函数内进行，初始化函数调度
- 非必要不要覆盖模块
- 避免使用可能与其他模块冲突的全局变量

## 调试与日志
模块加载时会自动输出详细信息，包括：
- 模块配置信息
- 路径注册状态
- 加载顺序和优先级

## 故障排除

### 常见问题
1. **模块未加载**：检查 `enabled` 配置和文件路径
2. **路径冲突**：确认模块名称唯一性
3. **加载顺序异常**：调整优先级数值

